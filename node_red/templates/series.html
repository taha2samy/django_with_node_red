<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Series Data</title>
    <!-- Include Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const socket = new WebSocket("ws://" + window.location.host + "/ws/mywebsocket/series");

            // Data arrays for Plotly.js
            let xValues = [];
            let yValues = [];

            // Create a new plot
            const plotData = [{
                x: xValues,
                y: yValues,
                mode: 'lines+markers',
                type: 'scatter',
                name: 'Series Data'
            }];

            const layout = {
                title: 'Series Data',
                xaxis: {
                    title: 'X Values',
                    showgrid: true,
                    zeroline: true
                },
                yaxis: {
                    title: 'Y Values',
                    showline: true
                }
            };

            Plotly.newPlot('myPlot', plotData, layout);

            socket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                const point = data['message']; // Assuming point is an object with {x, y}
                console.log(point);

                // Append new point to the existing data arrays
                xValues.push(point.x);
                yValues.push(point.y);

                // Display the point as a dict below the plot
                const pointDisplay = document.createElement('div');
                pointDisplay.textContent = `Point received: ${JSON.stringify(point)}`;
                document.getElementById('pointContainer').appendChild(pointDisplay);

                // Remove the oldest point if there are more than 10 points
                if (xValues.length > 10) {
                    xValues.shift(); // Remove the first (oldest) x value
                    yValues.shift(); // Remove the first (oldest) y value
                }

                Plotly.update('myPlot', {
                    x: [xValues],
                    y: [yValues]
                });
            };

            socket.onclose = function(e) {
                console.error('WebSocket closed unexpectedly');
            };
        });
    </script>
</head>
<body>
    <h1>Series Data</h1>
    <!-- Div for Plotly.js -->
    <div id="myPlot" style="width: 100%; height: 400px;"></div>
    
    <!-- Div to display received points -->
    <div id="pointContainer" style="margin-top: 20px;"></div>
</body>
</html>
